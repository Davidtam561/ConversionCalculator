<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מחשבון המרות</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: system-ui, sans-serif;
            line-height: 1.5;
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
            background: #f0f2f5;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { text-align: center; color: #1a73e8; margin: 10px 0; }
        .tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            margin: 10px 0;
            padding: 5px;
        }
        .tab {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
        }
        .tab.active { background: #1557b0; }
        input, select {
            width: 100%;
            padding: 8px;
            margin: 5px 0 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            text-align: center;
        }
        .update-time {
            font-size: 0.8em;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }
        .converter { display: none; }
        .converter.active { display: block; }
        .loading { color: #666; font-style: italic; }
        @media (max-width: 600px) {
            body { padding: 10px; }
            .tabs { flex-wrap: wrap; }
        }
    </style>
</head>
<body>
    <h1>מחשבון המרות מקוון</h1>
    
    <div class="tabs">
        <button class="tab active" onclick="showTab('currency')">מטבעות</button>
        <button class="tab" onclick="showTab('crypto')">קריפטו</button>
        <button class="tab" onclick="showTab('weight')">משקל</button>
        <button class="tab" onclick="showTab('text')">תיקון טקסט</button>
    </div>

    <div id="currency" class="converter card active">
        <input type="number" id="currencyAmount" placeholder="סכום" oninput="convert('currency')">
        <select id="currencyFrom" onchange="convert('currency')">
            <option value="ILS">₪ שקל</option>
            <option value="USD">$ דולר</option>
            <option value="EUR">€ יורו</option>
            <option value="GBP">£ פאונד</option>
        </select>
        <select id="currencyTo" onchange="convert('currency')">
            <option value="USD">$ דולר</option>
            <option value="ILS">₪ שקל</option>
            <option value="EUR">€ יורו</option>
            <option value="GBP">£ פאונד</option>
        </select>
        <div id="currencyResult" class="result">הזן סכום להמרה</div>
        <div id="currencyUpdate" class="update-time"></div>
    </div>

    <div id="crypto" class="converter card">
        <input type="number" id="cryptoAmount" placeholder="סכום" oninput="convert('crypto')">
        <select id="cryptoFrom" onchange="convert('crypto')">
            <option value="bitcoin">Bitcoin</option>
            <option value="ethereum">Ethereum</option>
            <option value="dogecoin">Dogecoin</option>
        </select>
        <select id="cryptoTo" onchange="convert('crypto')">
            <option value="usd">$ דולר</option>
            <option value="ils">₪ שקל</option>
            <option value="eur">€ יורו</option>
        </select>
        <div id="cryptoResult" class="result">הזן סכום להמרה</div>
        <div id="cryptoUpdate" class="update-time"></div>
    </div>

    <div id="weight" class="converter card">
        <input type="number" id="weightAmount" placeholder="ערך" oninput="convert('weight')">
        <select id="weightFrom" onchange="convert('weight')">
            <option value="kg">קילוגרם</option>
            <option value="g">גרם</option>
            <option value="lb">ליברה</option>
            <option value="oz">אונקיה</option>
        </select>
        <select id="weightTo" onchange="convert('weight')">
            <option value="g">גרם</option>
            <option value="kg">קילוגרם</option>
            <option value="lb">ליברה</option>
            <option value="oz">אונקיה</option>
        </select>
        <div id="weightResult" class="result">הזן משקל להמרה</div>
    </div>

    <div id="text" class="converter card">
        <input type="text" id="textInput" placeholder="טקסט שנכתב עם Caps Lock..." oninput="convert('text')">
        <div id="textResult" class="result">הקלד טקסט לתיקון</div>
    </div>

    <script>
        let rates = {};
        let cryptoRates = {};

        const weightConversions = {
            g: 1,
            kg: 1000,
            lb: 453.592,
            oz: 28.3495
        };

        // טעינת שערי מטבעות בהפעלה
        async function loadRates() {
            try {
                const response = await fetch('https://api.frankfurter.app/latest?from=USD');
                const data = await response.json();
                rates = data.rates;
                rates.USD = 1;
                document.getElementById('currencyUpdate').textContent = 
                    `עודכן: ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                document.getElementById('currencyResult').textContent = 
                    'שגיאה בטעינת שערי מטבעות. נסה שוב מאוחר יותר.';
            }
        }

        // טעינת שערי קריפטו
        async function loadCryptoRates() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,dogecoin&vs_currencies=usd,ils,eur');
                cryptoRates = await response.json();
                document.getElementById('cryptoUpdate').textContent = 
                    `עודכן: ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                document.getElementById('cryptoResult').textContent = 
                    'שגיאה בטעינת שערי קריפטו. נסה שוב מאוחר יותר.';
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.converter').forEach(conv => conv.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[onclick="showTab('${tabName}')"]`).classList.add('active');
        }

        async function convert(type) {
            const amount = parseFloat(document.getElementById(type + 'Amount')?.value);
            if (isNaN(amount)) return;

            switch(type) {
                case 'currency':
                    const from = document.getElementById('currencyFrom').value;
                    const to = document.getElementById('currencyTo').value;
                    try {
                        const response = await fetch(`https://api.frankfurter.app/latest?amount=${amount}&from=${from}&to=${to}`);
                        const data = await response.json();
                        document.getElementById('currencyResult').textContent = 
                            `${amount} ${from} = ${data.rates[to]} ${to}`;
                        document.getElementById('currencyUpdate').textContent = 
                            `עודכן: ${new Date().toLocaleTimeString()}`;
                    } catch {
                        document.getElementById('currencyResult').textContent = 'שגיאה בהמרה. נסה שוב.';
                    }
                    break;

                case 'crypto':
                    const crypto = document.getElementById('cryptoFrom').value;
                    const currency = document.getElementById('cryptoTo').value;
                    if (!cryptoRates[crypto]) await loadCryptoRates();
                    const rate = cryptoRates[crypto]?.[currency];
                    if (rate) {
                        const result = amount * rate;
                        document.getElementById('cryptoResult').textContent = 
                            `${amount} ${crypto} = ${result.toFixed(2)} ${currency.toUpperCase()}`;
                    }
                    break;

                case 'weight':
                    const fromUnit = document.getElementById('weightFrom').value;
                    const toUnit = document.getElementById('weightTo').value;
                    const grams = amount * weightConversions[fromUnit];
                    const result = grams / weightConversions[toUnit];
                    document.getElementById('weightResult').textContent = 
                        `${amount} ${fromUnit} = ${result.toFixed(2)} ${toUnit}`;
                    break;

                case 'text':
                    const text = document.getElementById('textInput').value;
                    const result = text.split('').map(char => {
                        if (char >= 'a' && char <= 'z') return char.toUpperCase();
                        if (char >= 'A' && char <= 'Z') return char.toLowerCase();
                        return char;
                    }).join('');
                    document.getElementById('textResult').textContent = result;
                    break;
            }
        }

        // טעינת שערים בהפעלה ראשונית
        loadRates();
        loadCryptoRates();
    </script>
</body>
</html>
