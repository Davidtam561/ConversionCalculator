<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מחשבון המרות 3.0</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,sans-serif}body{max-width:800px;margin:0 auto;padding:15px;background:#f0f2f5;line-height:1.5}h1{text-align:center;color:#1a73e8;margin:10px 0}.card{background:#fff;border-radius:8px;padding:15px;margin:10px 0;box-shadow:0 2px 4px rgba(0,0,0,.1)}.tabs{display:flex;gap:10px;overflow-x:auto;margin:10px 0;padding:5px}.tab{background:#1a73e8;color:#fff;border:none;padding:8px 16px;border-radius:20px;cursor:pointer;white-space:nowrap}.tab.active{background:#1557b0}input,select{width:100%;padding:8px;margin:5px 0 10px;border:1px solid #ddd;border-radius:4px}.result{display:none;background:linear-gradient(45deg,#1a73e8,#1557b0);color:#fff;padding:15px;border-radius:8px;margin-top:15px;text-align:center;font-size:1.2em;box-shadow:0 2px 4px rgba(0,0,0,.2)}.result.show{display:block;animation:fadeIn .3s ease}.converter{display:none}.converter.active{display:block}.update-time{font-size:.8em;color:#fff;text-align:center;margin-top:5px}.version{position:fixed;bottom:10px;left:10px;color:#666;font-size:.8em}.convert-btn{background:#4caf50;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;width:100%;font-size:1em;margin-top:10px;transition:background .3s}.convert-btn:hover{background:#45a049}.loading{color:#666;text-align:center;margin:10px 0}@keyframes fadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@media (max-width:600px){body{padding:10px}.tabs{flex-wrap:wrap}}
    </style>
</head>
<body>
    <h1>מחשבון המרות</h1>
    
    <div class="tabs">
        <button class="tab active" onclick="showTab('currency')">מטבעות</button>
        <button class="tab" onclick="showTab('crypto')">קריפטו</button>
        <button class="tab" onclick="showTab('weight')">משקל</button>
        <button class="tab" onclick="showTab('text')">תיקון טקסט</button>
    </div>

    <div id="currency" class="converter card active">
        <input type="number" id="currencyAmount" placeholder="סכום">
        <select id="currencyFrom">
            <option value="ILS">₪ שקל</option>
            <option value="USD">$ דולר</option>
            <option value="EUR">€ יורו</option>
            <option value="GBP">£ פאונד</option>
        </select>
        <select id="currencyTo">
            <option value="USD">$ דולר</option>
            <option value="ILS">₪ שקל</option>
            <option value="EUR">€ יורו</option>
            <option value="GBP">£ פאונד</option>
        </select>
        <button class="convert-btn" onclick="convert('currency')">המר מטבע</button>
        <div id="currencyResult" class="result">
            <div id="currencyValue"></div>
            <div id="currencyUpdate" class="update-time"></div>
        </div>
    </div>

    <div id="crypto" class="converter card">
        <input type="number" id="cryptoAmount" placeholder="סכום">
        <select id="cryptoFrom">
            <option value="bitcoin">Bitcoin</option>
            <option value="ethereum">Ethereum</option>
            <option value="dogecoin">Dogecoin</option>
        </select>
        <select id="cryptoTo">
            <option value="usd">$ דולר</option>
            <option value="eur">€ יורו</option>
        </select>
        <button class="convert-btn" onclick="convert('crypto')">המר קריפטו</button>
        <div id="cryptoResult" class="result">
            <div id="cryptoValue"></div>
            <div id="cryptoUpdate" class="update-time"></div>
        </div>
    </div>

    <div id="weight" class="converter card">
        <input type="number" id="weightAmount" placeholder="ערך">
        <select id="weightFrom">
            <option value="kg">קילוגרם</option>
            <option value="g">גרם</option>
            <option value="lb">ליברה</option>
            <option value="oz">אונקיה</option>
        </select>
        <select id="weightTo">
            <option value="g">גרם</option>
            <option value="kg">קילוגרם</option>
            <option value="lb">ליברה</option>
            <option value="oz">אונקיה</option>
        </select>
        <button class="convert-btn" onclick="convert('weight')">המר משקל</button>
        <div id="weightResult" class="result"></div>
    </div>

    <div id="text" class="converter card">
        <input type="text" id="textInput" placeholder="טקסט שנכתב עם Caps Lock...">
        <button class="convert-btn" onclick="convert('text')">תקן טקסט</button>
        <div id="textResult" class="result"></div>
    </div>

    <div class="version">גרסה 3.0</div>

    <script>
        const weightConversions = {g: 1, kg: 1000, lb: 453.592, oz: 28.3495};
        let rates = null;
        let cryptoRates = null;

        function showTab(tabName) {
            document.querySelectorAll('.converter').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[onclick="showTab('${tabName}')"]`).classList.add('active');
        }

        function showResult(elementId) {
            const result = document.getElementById(elementId);
            result.classList.remove('show');
            void result.offsetWidth; // Trigger reflow
            result.classList.add('show');
        }

        async function getRates() {
            try {
                const response = await fetch('https://api.exchangerate.host/latest?base=USD');
                const data = await response.json();
                rates = data.rates;
                rates.USD = 1;
                return rates;
            } catch (error) {
                document.getElementById('currencyValue').textContent = 'שגיאה בטעינת שערים';
                throw error;
            }
        }

        async function getCryptoRates() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,dogecoin&vs_currencies=usd,eur');
                cryptoRates = await response.json();
                return cryptoRates;
            } catch (error) {
                document.getElementById('cryptoValue').textContent = 'שגיאה בטעינת שערים';
                throw error;
            }
        }

        async function convert(type) {
            const amount = parseFloat(document.getElementById(type + 'Amount')?.value);
            if (isNaN(amount)) {
                alert('נא להזין מספר תקין');
                return;
            }

            switch(type) {
                case 'currency':
                    const currentRates = rates || await getRates();
                    const from = document.getElementById('currencyFrom').value;
                    const to = document.getElementById('currencyTo').value;
                    if (!currentRates) return;
                    
                    const rate = currentRates[to] / currentRates[from];
                    const result = amount * rate;
                    
                    document.getElementById('currencyValue').textContent = 
                        `${amount} ${from} = ${result.toFixed(2)} ${to}`;
                    document.getElementById('currencyUpdate').textContent = 
                        `עודכן: ${new Date().toLocaleTimeString()}`;
                    showResult('currencyResult');
                    break;

                case 'crypto':
                    const currentCryptoRates = cryptoRates || await getCryptoRates();
                    const crypto = document.getElementById('cryptoFrom').value;
                    const currency = document.getElementById('cryptoTo').value;
                    if (!currentCryptoRates) return;

                    const cryptoRate = currentCryptoRates[crypto]?.[currency];
                    if (cryptoRate) {
                        const cryptoResult = amount * cryptoRate;
                        document.getElementById('cryptoValue').textContent = 
                            `${amount} ${crypto} = ${cryptoResult.toFixed(2)} ${currency.toUpperCase()}`;
                        document.getElementById('cryptoUpdate').textContent = 
                            `עודכן: ${new Date().toLocaleTimeString()}`;
                        showResult('cryptoResult');
                    }
                    break;

                case 'weight':
                    const fromUnit = document.getElementById('weightFrom').value;
                    const toUnit = document.getElementById('weightTo').value;
                    const grams = amount * weightConversions[fromUnit];
                    const weightResult = grams / weightConversions[toUnit];
                    document.getElementById('weightResult').textContent = 
                        `${amount} ${fromUnit} = ${weightResult.toFixed(2)} ${toUnit}`;
                    showResult('weightResult');
                    break;

                case 'text':
                    const text = document.getElementById('textInput').value;
                    if (!text) {
                        alert('נא להזין טקסט');
                        return;
                    }
                    const fixedText = text.split('').map(char => {
                        if (char >= 'a' && char <= 'z') return char.toUpperCase();
                        if (char >= 'A' && char <= 'Z') return char.toLowerCase();
                        return char;
                    }).join('');
                    document.getElementById('textResult').textContent = fixedText;
                    showResult('textResult');
                    break;
            }
        }

        // טעינה ראשונית של שערי המרה
        getRates();
        getCryptoRates();
    </script>
</body>
</html>
